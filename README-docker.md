# Контейнеризация проекта CRMpy

## Структура контейнеризации

Проект CRMpy теперь полностью контейнеризован с использованием Docker и Docker Compose:

- **backend**: FastAPI приложение на Python с SQLite базой данных
- **frontend**: Next.js приложение на React
- **database**: Контейнер с файловой системой для хранения базы данных (совместимо с Яндекс.Облаком)

## Файлы контейнеризации

- `docker-compose.yml` - основной файл оркестрации сервисов
- `backend/Dockerfile` - Dockerfile для бэкенда
- `frontend/Dockerfile` - Dockerfile для фронтенда
- `backend/.dockerignore` - исключения для сборки бэкенда
- `frontend/.dockerignore` - исключения для сборки фронтенда

## Запуск приложения

1. Убедитесь, что Docker и Docker Compose установлены
2. В корне проекта выполните:
   ```bash
   docker-compose up --build
   ```

## Доступ к сервисам

- **Фронтенд**: http://localhost:3000
- **Бэкенд API**: http://localhost:8080

## Структура данных

- База данных SQLite монтируется в volume `db_data`
- Загруженные файлы (`uploads`) монтируются из хостовой системы
- Все данные сохраняются между перезапусками контейнеров

## Переменные окружения

- `DATABASE_URL`: URL подключения к базе данных (по умолчанию SQLite)
- `NEXT_PUBLIC_API_URL`: URL API для фронтенда (http://backend:8080)

## Совместимость с Яндекс.Облаком

Контейнеризация оптимизирована для развертывания в Яндекс.Облаке:
- Используются минималистичные базовые образы
- Все порты корректно открыты (8080 для бэкенда, 3000 для фронтенда)
- Данные монтируются в volumes для персистентности
- База данных работает в контейнере для лучшей изоляции

## Команды управления

```bash
# Запуск всех сервисов
docker-compose up -d

# Остановка всех сервисов
docker-compose down

# Просмотр логов
docker-compose logs -f

# Пересборка образов
docker-compose build --no-cache

# Масштабирование сервисов
docker-compose up -d --scale frontend=3
```

## Аутентификация

При первом запуске база данных автоматически инициализируется с пользователями:
- admin1 / nimda (администратор)
- admin2 / nimda (администратор)
- logist / logist (логист)
- work / work (рабочий)